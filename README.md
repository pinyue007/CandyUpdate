# 升级程序

## 1. 开发语言  
升级程序主要使用 Go 语言开发。

## 2. 升级程序命名
- Windows: Update.exe
- 其他系统通过自身包管理器管理升级。

## 3. 程序设计
>### 3.1 启动方式
- 升级程序采用 主程序 唤醒启动方式，不做开机启动一直占用系统资源。
- 升级程序被唤醒时，拷贝程序到安装目录下的 Temp 目录启动执行。
- 升级方式如下：
  - 主程序 **<u>启动时立即唤起</u>** 升级程序检测升级。
  - 主程序 **<u>整点唤起</u>** 升级程序检测升级。
  - 主程序 **<u>根据配置唤起</u>** 升级程序检测升级（界面配置逐步实现）。

> ### 3.2 升级检测
- 版本号规则：x.y.z-r
- 获取最新发布版本号：通过升级文件的方式管理最新发布版本号。
- 获取本地运行的 Candy 版本号：主程序唤起升级程序时将版本号作为参数传给升级程序。
```
  主程序唤起升级程序传参示例：
  1. path: https://dl.icandy.one/   # 升级包下载地址
  2. pkgname: candy                 # 升级包名
  3. version: 4.1-1                 # 当前版本号
  4. temp: /xxx/xxx/Temp            # 下载目录
```
- 比较版本号是否一致，不一致则下载发布版本至安装目录下的 Temp 目录。

> ### 3.3 执行升级
- 停止candy服务。
- 执行静默安装。
